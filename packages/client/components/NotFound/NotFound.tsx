import styled from '@emotion/styled'
import React, {useEffect, useRef, useState} from 'react'
import {useTranslation} from 'react-i18next'
import {PALETTE} from '../../styles/paletteV3'
import Confetti from '../Confetti'

const Background = styled('div')({
  display: 'flex',
  background: 'radial-gradient(ellipse at center, #45484d 0%, #000000 100%)',
  height: '100%',
  width: '100%',
  justifyContent: 'center',
  alignItems: 'center'
})

const LOGO_WIDTH = 320
const LOGO_HEIGHT = 320

const Logo = styled('div')({
  left: 0,
  top: 0,
  position: 'absolute'
})

const Label = styled('div')({
  color: '#fff',
  display: 'flex',
  justifyContent: 'center',
  alignItems: 'center',
  height: 0,
  fontWeight: 600,
  fontSize: LOGO_WIDTH / 6,
  transform: `translateY(-${LOGO_HEIGHT / 2}px)`
})
const Centroid = styled('div')({})
const colors = [
  [PALETTE.GRAPE_700, PALETTE.TOMATO_500, PALETTE.AQUA_400],
  [PALETTE.GRAPE_700, PALETTE.AQUA_400, PALETTE.TOMATO_500],
  [PALETTE.AQUA_400, PALETTE.GRAPE_700, PALETTE.TOMATO_500],
  [PALETTE.AQUA_400, PALETTE.TOMATO_500, PALETTE.GRAPE_700],
  [PALETTE.TOMATO_500, PALETTE.AQUA_400, PALETTE.GRAPE_700],
  [PALETTE.TOMATO_500, PALETTE.GRAPE_700, PALETTE.AQUA_400],
  [PALETTE.GRAPE_700, PALETTE.GRAPE_700, PALETTE.GRAPE_700],
  [PALETTE.TOMATO_500, PALETTE.TOMATO_500, PALETTE.TOMATO_500],
  [PALETTE.AQUA_400, PALETTE.AQUA_400, PALETTE.AQUA_400]
]

const maxX = window.innerWidth - LOGO_WIDTH
const maxY = window.innerHeight - LOGO_HEIGHT
let dirX = Math.round(Math.random()) * 2 - 1
let dirY = Math.round(Math.random()) * 2 - 1
let curX = Math.floor(Math.random() * maxX)
let curY = Math.floor(Math.random() * maxY)
let palette = colors[Math.floor(Math.random() * colors.length)]!
const speed = 4

const move = (el: HTMLImageElement, onWin: () => void) => {
  const diffX = dirX * speed
  const diffY = dirY * speed
  const nextX = curX + diffX
  const nextY = curY + diffY
  curX = nextX > maxX ? maxX - (nextX - maxX) : nextX < 0 ? -nextX : nextX
  curY = nextY > maxY ? maxY - (nextY - maxY) : nextY < 0 ? -nextY : nextY
  dirX = curX === nextX ? dirX : dirX * -1
  dirY = curY === nextY ? dirY : dirY * -1
  el.style.transform = `translate3d(${curX}px,${curY}px,0)`
  const isChange = curX !== nextX || curY !== nextY
  if (isChange) {
    let nextPalette = palette
    while (nextPalette === palette) {
      nextPalette = colors[Math.floor(Math.random() * colors.length)]!
    }
    palette = nextPalette
    const wings = Array.from((el as any).firstChild.firstChild.children) as SVGPathElement[]
    wings.forEach((wing, idx) => {
      wing.setAttribute('fill', palette[idx]!)
    })
    if (curX !== nextX && curY !== nextY) {
      onWin()
    }
  }

  requestAnimationFrame(() => {
    move(el, onWin)
  })
}

const NotFound = () => {
  const {t} = useTranslation()

  const ref = useRef<HTMLImageElement>(null)
  const [active, _setActive] = useState(false)
  const setActive = () => {
    _setActive(true)
    requestAnimationFrame(() => {
      _setActive(false)
    })
  }
  useEffect(() => {
    move(ref.current!, setActive)
  }, [])
  return (
    <Background>
      <Logo ref={ref}>
        <svg
          width={LOGO_WIDTH}
          height={LOGO_HEIGHT}
          viewBox={t('NotFound.003128')}
          fill='none'
          xmlns='http://www.w3.org/2000/svg'
        >
          <g id='mark-color'>
            <path
              id={t('NotFound.Union')}
              fillRule='evenodd'
              clipRule='evenodd'
              d={t(
                'NotFound.M178303332541C176044310841173773289441171483269241C170023256441168563244141167103231941C166626227937166151223814165677219693C164919213109164163206529163394200441C190144017640721536403285982325040656403C2507931712425889443794125475379774C25427484004125357388364125274492774C2525859362372524944771252213953342C25209595879425197696425925186496974C251223100074250504103224249703106394C249293107984248864109604248424111214C247554114334246614117494245603120644C245419121216245238121789245057122361C24475123339244442124316244114125294C2439912563724388312598324377612633C243673126661243571126992243453127324L243403127214C238994117384234033107694228604982941C22300488604121683379444121041470594C2096469532220887568458620811673859C2065366517522049636296820331360874C19994456584196514525041193033485541C192328477492191614469865190901462234C190461457538190022452841189584448041C18720342204118483439644182413372141C1815363007180577354234179656345459C179204341168178754336876178303332541Zm131766248418C133995250548136226252658138486254648C13971325574114095325678614219257828L142926258448C1434352588714394259309144446259749C145162260371145879260994146605261568C11985627983894646284908774963275038C592261264468511255237788552661201828C557556197548564563193188572656188788C57429218790357619618701857811318613C579236185604580371185077581458184548C587854181468594958178348602856175208C60686173618611157172028615552170438C624255167278633752164088644055160878C64625216021648389159537650525158863C653064158065655603157265658252156468C659338156145660339155827661328155509C6626115509866389215469665356154278L665955154398C709863164178759363173858813855183288C869153192888931152202088996057211038C100376212095101135213163101895214231C103463216436105032218642106696220758C110066225038113506229128116986233078C117637233815118295234519118951235222C11944523575119937236278120426236818C122805239398125176241948127576244378C128616245418129662246414130709247411L131766248418Z'
              )}
              fill={palette[0]}
            />
            <path
              id='Union_2'
              fillRule='evenodd'
              clipRule='evenodd'
              d={t(
                'NotFound.M595251713997L59101671553C584338718031577466720386570605722739C5623787255655417572837754631373143C5217164052316036131645317750120656311C83271503243189951201553049735230155304C1134310155304132322092730715202123903C1554422643311588622922316226232153C162957327336163638333502164324339699C164724343321165126346953165532350531C167871371531702113931317254241573C1737324273317492243923176112451331C178402474531806424984318288252303L183984535095C18469454282418540455056918610255853C18632856112418655956360518679566092C187048568878187308571671187562574631C18752257463118748257463118744157453C1657625521314363255393112196257653L119951578554C1165915819171132358527810991259003C10451259783992419607139408261763C930383619717920264622086910132624455C90426625832898376627208892419628531C857812636138234136439378991765273C777637656062765601659608753613663145C74725366502174089466689373452166873C7049196773367541568613646814695731C629358701642612329707809595251713997Zm25064221014L250918210039C251548209808252194209588252839209367C253702209073254564208779255387208459C257848241059249647265129232498275039C214208285589186787279079157977257719C154537255159151107252349147677249419C147031248869146389248285145745247701C145383247372145021247043144657246719C142228244539139797242299137378239939C136238238839135117237709133988236559C131658234199129358231759127068229249L12611228196C125376227393124645226591123927225769C123717225533123502225304123289225075C123004224771122721224468122448224149C122488224159122528224159122577224159C144108226349166538226179188058223969L190614223707C19379222338419697422306200088222619C205468221839210708220909215857219869C216963219644218042219392219124219139C219772218987220421218835221078218689C224408217949227727217199230938216349C232311215983233655215587234993215192L236677214699C239597213849242488212979245298212029C2471132114324887521078625064221014Z'
              )}
              fill={palette[1]}
            />
            <path
              id='Union_3'
              fillRule='evenodd'
              clipRule='evenodd'
              d={t(
                'NotFound.M466943191338C4652341922463513193063462305193906C16750517972601605860140786C011968619050399326522803849361C56190283246603101816661645496801761C6545979857266391679556767324279256L68649978826C71660277846174720576896177850376006C79439775556810475126826697747061C8586067387689119973106192419472386C92928572276893435172164939404720514C9491771834195892371617968799714261C971887713697491571292397793712248C9822147112929864571034199079670946L990613709729C9904427099819902477102719901710561C92750279706186850688836181390498286C758105107966709595117916664905127926C6597912907365456513021764934113136C637805133884626282136403616101138936C5958981440065776149026560803154006C557446155029554395156037551355157043C5493915769547437158337545398158986C534998162286524805165576516003168826C5111821706507019172358502844174122L501599174646C494397177556487598180456481702183326C477502185376473999187416470496189456C469446190077468188190707466943191338Zm25839811282C257528116032565281192725549812251C25527812320725507123899254862124591C25455912559625425712660125391812762C25223913259250408137624838914265C247358145243246185147801245012150363C2445115145724400915255224351815365C239038163712341781736722861818329C223179192732172582018721097821058C210958210612109392106421090821067C211279210604211639210522212210441C21234721036221269421028421304821022C213898210045214736209861215574209678C2163112095162170472093552177882092C221038208492242292077322736820692C22896920652305482060823211820564C235288204752383782037824141820277L24256202403C243503202124444920179824536920147C249618199972537681983925774819667C290948182283099991619130999914079C3099991210129324810187263788877C263657885768263481894678263306903581C263185909706263064915828262958921901C2626099422262258962401261838982901C261259101142605791040225986810691L259565108168C2591931097225882311126125839811282Z'
              )}
              fill={palette[2]}
            />
          </g>
        </svg>
        <Label>{t('NotFound.404')}</Label>
      </Logo>
      <Centroid>
        <Confetti active={active} />
      </Centroid>
    </Background>
  )
}

export default NotFound
